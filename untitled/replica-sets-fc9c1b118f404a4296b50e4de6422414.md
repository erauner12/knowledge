# Replica Sets fc9c1b118f404a4296b50e4de6422414

## Replica Sets

## Overview

Higher unit of orchestration. Will supervise the pods

Used to create and mainteain certain number of Pod Replicas

* increaase or decrease \# of pods

Uses labels and selectors to identify which pods to control

creation of pods will be managed by replica set

* need to provide to the yaml file

## Working with replica sets

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: replicaset-guestbook
  labels:
    app: guestbook
    tier: frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      tier: frontend
    matchExpressions:
      - {key: tier, operator: In, values: [frontend]}
  template:
    metadata:
      labels:
        app: guestbook
        tier: frontend
    spec:
      containers:
      - name: php-redis
        image: gcr.io/google_samples/gb-frontend:v3
        ports:
        - containerPort: 80
```

`Kind` type unit chnaging to `ReplicaSet`

`spec`

* `replicas` 3
  * 3 pods
* `selector` -
  * mechanisms used by `replicaSet`
* `template`
* `spec`
* Here is the container spec from earlier

```yaml
replicaset-guestbook-f5r95   0/1     ContainerCreating   0          4s
replicaset-guestbook-lsh6j   0/1     ContainerCreating   0          4s
replicaset-guestbook-sb2jz   0/1     ContainerCreating   0          5s
```

```yaml
er046256@w1738944  ~/tmp/Container-Masterclass-Codes/CC_Kubernetes/S10  kubectl describe pods replicaset-guestbook-f5r95
Name:         replicaset-guestbook-f5r95
Namespace:    default
Priority:     0
Node:         docker-desktop/192.168.65.3
Start Time:   Sat, 09 Jan 2021 17:17:34 -0600
Labels:       app=guestbook
              tier=frontend
Annotations:  <none>
Status:       Running
IP:           10.1.0.13
IPs:
  IP:           10.1.0.13
Controlled By:  ReplicaSet/replicaset-guestbook
Containers:
  php-redis:
    Container ID:   docker://3e23222bcdb7868248716b29f8b38af50e90e33aa10dfae189ed2ee172ae58ed
    Image:          gcr.io/google_samples/gb-frontend:v3
    Image ID:       docker-pullable://gcr.io/google_samples/gb-frontend@sha256:50b22839aaf6a18586d6751e8963cf684c27b9873ca926df22cdf88ed4452615
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sat, 09 Jan 2021 17:17:59 -0600
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-q4hf6 (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-q4hf6:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-q4hf6
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  52s   default-scheduler  Successfully assigned default/replicaset-guestbook-f5r95 to docker-desktop
  Normal  Pulling    51s   kubelet            Pulling image "gcr.io/google_samples/gb-frontend:v3"
  Normal  Pulled     27s   kubelet            Successfully pulled image "gcr.io/google_samples/gb-frontend:v3" in 24.114487s
  Normal  Created    27s   kubelet            Created container php-redis
  Normal  Started    27s   kubelet            Started container php-redis
```

### To see all replicasets

```yaml
er046256@w1738944  ~/tmp/Container-Masterclass-Codes/CC_Kubernetes/S10  kubectl get rs
NAME                   DESIRED   CURRENT   READY   AGE
replicaset-guestbook   3         3         3       80s
```

```yaml
er046256@w1738944  ~/tmp/Container-Masterclass-Codes/CC_Kubernetes/S10  kubectl describe rs replicaset-guestbook
Name:         replicaset-guestbook
Namespace:    default
Selector:     tier=frontend,tier in (frontend)
Labels:       app=guestbook
              tier=frontend
Annotations:  <none>
Replicas:     3 current / 3 desired
Pods Status:  3 Running / 0 Waiting / 0 Succeeded / 0 Failed
Pod Template:
  Labels:  app=guestbook
           tier=frontend
  Containers:
   php-redis:
    Image:        gcr.io/google_samples/gb-frontend:v3
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Events:
  Type    Reason            Age   From                   Message
  ----    ------            ----  ----                   -------
  Normal  SuccessfulCreate  110s  replicaset-controller  Created pod: replicaset-guestbook-sb2jz
  Normal  SuccessfulCreate  110s  replicaset-controller  Created pod: replicaset-guestbook-f5r95
  Normal  SuccessfulCreate  110s  replicaset-controller  Created pod: replicaset-guestbook-lsh6j
```

